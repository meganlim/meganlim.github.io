<html>
<head>
  <title> Kalman Filter </title>
  <link rel="stylesheet" type="text/css" href="kalman_filter.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <script src = "https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.2.1/math.js" type="text/javascript"></script>
  <h1> Kalman Filter Calculator </h1>
</head>

<body>
  <div class = "input">
    Mean Vector (x): <input type="text" id="meanVector" placeholder = "[x, p]"><br>
    Covariance Matrix (C): <input type="text" id="covMatrix" placeholder = "[[pp, pv], [vp, vv]]"><br>
    Prediction Matrix (P): <input type="text" id="predictMatrix" placeholder = "[[a, b], [c, d]]"><br>
    External Influence Matrix (B): <input type="text" id="eMatrix" placeholder = "[[a, b], [c, d]]"><br>
    External Influence Vector (u): <input type="text" id="eVector" placeholder = "[a, b]"><br>
    Uncertainty Covariance Matrix (Q): <input type="text" id="uncertMatrix" placeholder = "[[a, b], [c, d]]"><br><br>


    Sensor Matrix (S): <input type="text" id="sensorMatrix" placeholder = "[[a, b], [c, d]]"><br>
    Noise Matrix (N): <input type="text" id="noiseMatrix" placeholder = "[[a, b], [c, d]]"><br>
    Sensor Mean Vector (r): <input type="text" id="sensorVector" placeholder = "[a, b]"><br><br>

    <button id = "calculate">Calculate</button>
    <div class="box">
      <label style = "text-decoration:None">Discrete Time Step (k): </label>
      <div class = "counter" id="curr">0</div>
    </div><br><br>
  </div>

  <div class = "output">
  <div id = "predictMean"></div>
  <div id = "predictCovMatrix"></div><br>
  <div id = "transPredictMean"></div>
  <div id = "transPredictCov"></div><br>
  <div id = "kalmanGain"></div><br>
  <div id = "updatedMean"></div>
  <div id = "updatedCovMatrix"></div>
</div>


  <script type="text/javascript">

  var kStep = 0;

  calculate.addEventListener('click', function(e) {
    var x = math.matrix(JSON.parse(document.getElementById("meanVector").value));
    var P = math.matrix(JSON.parse(document.getElementById("predictMatrix").value));
    var B = math.matrix(JSON.parse(document.getElementById("eMatrix").value));
    var u = math.matrix(JSON.parse(document.getElementById("eVector").value));

    var C = math.matrix(JSON.parse(document.getElementById("covMatrix").value));
    var Q = math.matrix(JSON.parse(document.getElementById("uncertMatrix").value));

    var S = math.matrix(JSON.parse(document.getElementById("sensorMatrix").value));
    var N = math.matrix(JSON.parse(document.getElementById("noiseMatrix").value));
    var r = math.matrix(JSON.parse(document.getElementById("sensorVector").value));

    var predictMean = math.add(math.multiply(P, x), math.multiply(B, u));
    var predictCov = math.add(math.multiply(P, math.multiply(C, math.transpose(P))), Q)

    var transPredictMean = math.multiply(S, math.add(math.multiply(P, x), math.multiply(B, u)));
    var transPredictCov = math.multiply(S, math.multiply(math.add(math.multiply(P, math.multiply(C, math.transpose(P))), Q), math.transpose(S)));

    var kalmanGain = math.multiply(transPredictCov, math.inv(math.add(transPredictCov, N)));

    var kalmanGainPrime = math.multiply(math.inv(S), kalmanGain);
    var meanInside = math.subtract(math.multiply(kalmanGainPrime, r), math.multiply(kalmanGainPrime, math.multiply(S, x)));
    var updatedMean = math.add(x, meanInside);
    var updatedCovMatrix = math.subtract(C, math.multiply(kalmanGainPrime, math.multiply(S, C)));

    document.getElementById("predictMean").innerHTML = "Mean Vector Prediction: " + predictMean;
    document.getElementById("predictCovMatrix").innerHTML = "Covariance Matrix Prediction: " + predictCov;

    document.getElementById("transPredictMean").innerHTML = "Transformed Mean Vector Prediction: " + transPredictMean;
    document.getElementById("transPredictCov").innerHTML = "Transformed Covariance Matrix Prediction: " + transPredictCov;

    document.getElementById("kalmanGain").innerHTML = "Kalman Gain: " + kalmanGain;

    document.getElementById("updatedMean").innerHTML = "Updated Mean Vector: " + updatedMean;
    document.getElementById("updatedCovMatrix").innerHTML = "Updated Covariance Matrix: " + updatedCovMatrix;

    kStep++;
    document.getElementById('curr').textContent = kStep;
  });

  </script>

  <div class ="footer"><p>Copyright Â©2018 Megan Lim. All rights reserved.</p></div>

</body>
</html>

<!--
// [1,1]
// [[2,4],[1,3]]
// [[2,4],[3,6]]
// [[2,6],[3,1]]
// [1,1]
// [[9,2],[6,3]]
//
// [[2,3],[4,3]]
// [[2,1],[4,3]]
// [1,1] -->
